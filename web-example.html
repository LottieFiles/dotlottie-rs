<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WASM test</title>
  </head>

  <body>
    <h1>Test</h1>
    <div style="width: 800px">
      <label for="fit">Fit:</label>
      <select id="fit">
        <option value="1" selected>Contain</option>
        <option value="2">Fill</option>
        <option value="3">Cover</option>
        <option value="4">FitWidth</option>
        <option value="5">FitHeight</option>
        <option value="6">None</option>
      </select>
      <label for="align">Align:</label>
      <select id="align">
        <option value="0,0">top-left</option>
        <option value="0.5,0">top-center</option>
        <option value="1,0">top-right</option>

        <option value="0,0.5">center-left</option>
        <option value="0.5,0.5" selected>center</option>
        <option value="1,0.5">center-right</option>

        <option value="0,1">bottom-left</option>
        <option value="0.5,1">bottom-center</option>
        <option value="1,1">bottom-right</option>
      </select>
      <canvas
        style="width: 100%; height: 100%; border: 1px solid black"
      ></canvas>
      <button id="play">play</button>
      <button id="pause">pause</button>
      <button id="resize">resize</button>
      <select id="theme-select">
        <option value="">None</option>
        <option value="theme">Theme</option>
      </select>
      <input
        id="progress-bar"
        type="range"
        min="0"
        max="100"
        defaultValue="0"
        step="0.01"
      />
      <select id="mode">
        <option value="1">Forward</option>
        <option value="2">Reverse</option>
        <option value="3">Bounce</option>
        <option value="4">ReverseBounce</option>
      </select>
    </div>
    <button id="jump">Jump</button>
    <button id="speed-up">speed +</button>
    <button id="speed-down">speed -</button>
    <button id="loop">loopToggle</button>
    <button id="next">Next</button>
    <input id="bg-color" type="color" />
    <div>
      <label for="width">Rendering Area Width:</label>
      <input id="width" type="range" min="0" max="1" step="0.01" value="1" />
      <label for="height">Rendering Area Height:</label>
      <input id="height" type="range" min="0" max="1" step="0.01" value="1" />
    </div>
    <canvas id="thorvg-canvas" width="100" height="100"></canvas>
    <script type="module">
      import createDotLottiePlayerModule from "./release/wasm/DotLottiePlayer.mjs";

      const Module = await createDotLottiePlayerModule({
        locateFile: (path, prefix) => {
          if (path.endsWith(".wasm")) {
            return `release/wasm/${path}`;
          }
          return `${prefix}${path}`;
        },
      });

      const player = new Module.DotLottiePlayer(
        {
          ...Module.createDefaultConfig(),
          autoplay: true,
          loopAnimation: true,
        },
        Module.TvgEngine.TvgEngineGl,
        0,
        "#thorvg-canvas"
      );

      const data = await fetch(
        // "https://lottie.host/5c89381e-0d1a-4422-8247-f5b7e4b3c4e2/mqs5juC4PW.lottie"
        "./examples/demo-player/src/v2/gradient.json"
        // "https://lottie.host/294b684d-d6b4-4116-ab35-85ef566d4379/VkGHcqcMUI.lottie",
        // "https://lottie.host/edff17eb-9a84-41f7-810a-22b94fbf9143/uYveqJ1Kqn.lottie"
      ).then((res) => res.text());

      console.log(Module);

      const loaded = player.loadAnimationData(data, 100, 100);

      console.log({ loaded });

      if (loaded) {
        while (player.isPlaying()) {
          const nextFrame = player.requestFrame();
          if (player.setFrame(nextFrame)) {
            player.render();
          }
        }
      }
    </script>
  </body>
</html>
